<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deep Cleaning Price Calculator</title>

  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "vj9i1sfm9b");
  </script>

  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --text:#121212;
      --muted:#5c636b;
      --border:rgba(18,18,18,.12);

      --accent:#f5c400;
      --accent2:#ffdf6a;
      --accentDark:#1a1a1a;
      --shadow: 0 18px 55px rgba(0,0,0,.10);
      --radius:20px;
      --btnH:56px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 520px at 25% 0%, rgba(245,196,0,.22), transparent 60%),
        radial-gradient(760px 520px at 85% 10%, rgba(26,26,26,.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .hero{
      background: linear-gradient(180deg, rgba(245,196,0,.26), rgba(245,196,0,.08));
      border:1px solid rgba(245,196,0,.55);
      border-radius: var(--radius);
      padding:22px;
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .hero:after{
      content:"";
      position:absolute;right:-120px;top:-140px;
      width:340px;height:340px;border-radius:50%;
      background: rgba(26,26,26,.08);
    }
    .badge{
      display:inline-flex;gap:8px;align-items:center;
      padding:7px 12px;border-radius:999px;
      background: rgba(26,26,26,.92);
      border:1px solid rgba(26,26,26,.92);
      color:#fff;
      font-size:12px;
      letter-spacing:.2px;
    }
    h1{margin:10px 0 6px;font-size:30px;line-height:1.1}
    .sub{margin:0;color:rgba(18,18,18,.78);max-width:860px}
    .heroRow{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .heroPill{
      padding:10px 12px;border-radius:16px;
      background: rgba(255,255,255,.85);
      border:1px solid rgba(18,18,18,.10);
      font-weight:800;
      font-size:14px;
    }
    .heroPill b{color:var(--accentDark)}

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:16px;
      margin-top:16px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 6px;font-size:18px}
    .muted{color:var(--muted);font-size:13px}

    label{display:block;margin:12px 0 6px;font-size:14px;color: rgba(18,18,18,.88)}
    input, textarea, select{
      width:100%;
      padding:12px 12px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background:#fff;
      color:var(--text);
      font-size:15px;
      outline:none;
    }
    textarea{resize:vertical;min-height:104px}
    input::placeholder, textarea::placeholder{color: rgba(18,18,18,.45)}

    .row{display:grid;grid-template-columns: 1fr 1fr;gap:12px}
    @media (max-width: 560px){ .row{grid-template-columns:1fr} }

    .unitbar{
      display:flex;gap:10px;align-items:center;justify-content:space-between;
      padding:10px 12px;border-radius: 16px;
      border:1px solid var(--border);
      background: rgba(245,247,251,.95);
      margin-top:10px;
    }
    .seg{
      display:flex;gap:6px;align-items:center;
      border:1px solid var(--border);
      background:#fff;
      border-radius:999px;
      padding:4px;
    }
    .seg button{
      border:0;border-radius:999px;
      padding:9px 12px;
      font-size:13px;
      background:transparent;
      color: rgba(18,18,18,.70);
      cursor:pointer;
    }
    .seg button.active{
      background: rgba(245,196,0,.90);
      color:#111;
      border:1px solid rgba(245,196,0,.95);
    }

    .btn{
      width:100%;
      border:0;
      border-radius: 18px;
      height: var(--btnH);
      padding:0 16px;
      cursor:pointer;
      font-weight:900;
      font-size:16px;
      background: var(--accent);
      color:#111;
      margin-top:14px;
      box-shadow: 0 12px 28px rgba(245,196,0,.28);
    }
    .btn:active{transform: translateY(1px)}

    .btn.secondary{
      background: var(--accentDark);
      color:#fff;
      border:1px solid rgba(26,26,26,.95);
      margin-top:10px;
      box-shadow:none;
    }
    .btn.ghost{
      background:#fff;
      border:1px solid rgba(18,18,18,.16);
      box-shadow:none;
    }

    .result{
      margin-top:14px;
      padding:16px;
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(245,196,0,.14), rgba(245,196,0,.06));
      border:1px solid rgba(245,196,0,.45);
    }

    .priceTop{
      display:flex;align-items:baseline;justify-content:space-between;
      gap:10px;flex-wrap:wrap;
    }
    .priceLabel{font-size:14px;color:rgba(18,18,18,.70);font-weight:800}
    .priceValue{
      font-size:36px;
      line-height:1;
      font-weight:1000;
      letter-spacing:.2px;
      background: rgba(26,26,26,.92);
      color:#fff;
      padding:10px 14px;
      border-radius: 18px;
    }
    .note{margin:10px 0 0;color:rgba(18,18,18,.72);font-size:13px}

    .timebox{margin-top:12px;display:grid;grid-template-columns:1fr;gap:10px}
    .pill{
      padding:14px 14px;
      border-radius: 18px;
      border:1px solid rgba(18,18,18,.12);
      background:#fff;
      font-size:14px;
      color: rgba(18,18,18,.72);
    }
    .pill b{color:var(--text)}

    .ctaRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px}
    @media (max-width: 560px){ .ctaRow{grid-template-columns:1fr} }

    .hr{height:1px;background: rgba(18,18,18,.10);margin:16px 0}
    .small{font-size:12px;color: rgba(18,18,18,.60)}

    .contactGrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    @media (max-width: 560px){ .contactGrid{grid-template-columns:1fr} }
    .contactBtn{
      display:flex;align-items:center;justify-content:center;
      height: var(--btnH);
      border-radius: 18px;
      text-decoration:none;
      font-weight:950;
      border:1px solid rgba(18,18,18,.16);
      background:#fff;
    }
    .contactBtn.dark{background: rgba(26,26,26,.92); color:#fff; border-color: rgba(26,26,26,.92)}
    .contactBtn.yellow{background: var(--accent); color:#111; border-color: rgba(245,196,0,.95)}

    /* Modal scroll fix */
    .modal{
      position:fixed;inset:0;display:none;
      background: rgba(0,0,0,.55);
      padding:16px;
      z-index:50;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .modal.open{display:block}
    .modalCard{
      max-width: 980px;
      margin: 2vh auto;
      background:#fff;
      border:1px solid rgba(18,18,18,.16);
      border-radius: 22px;
      box-shadow: 0 20px 70px rgba(0,0,0,.25);
      overflow:hidden;
      max-height: 92vh;
      display:flex;
      flex-direction:column;
    }
    .modalHeader{
      display:flex;justify-content:space-between;align-items:center;
      padding:14px 16px;
      border-bottom:1px solid rgba(18,18,18,.10);
      background: rgba(245,196,0,.22);
    }
    .modalHeader h3{margin:0;font-size:16px}
    .closeBtn{
      border:1px solid rgba(18,18,18,.16);
      background: rgba(26,26,26,.92);
      color:#fff;
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:950;
    }
    .modalBody{
      padding:14px 16px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .gallery{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 860px){ .gallery{grid-template-columns:1fr} }
    .gItem{
      border:1px solid rgba(18,18,18,.12);
      border-radius: 16px;
      overflow:hidden;
      background:#fff;
    }
    .gItem .cap{
      padding:10px 12px;
      color: rgba(18,18,18,.70);
      font-size:13px;
      background: rgba(245,196,0,.10);
      border-bottom:1px solid rgba(18,18,18,.08);
    }
    .gItem img{width:100%;display:block;background:#fff}
    .gTitle{font-weight:950;color:var(--text);margin-right:8px}

    .stickyBar{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 12px;
      background: rgba(255,255,255,.92);
      border-top:1px solid rgba(18,18,18,.12);
      backdrop-filter: blur(10px);
      display:none;
      z-index:40;
    }
    .stickyBar .inner{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .stickyBar a{height:46px;border-radius:16px;font-weight:950}
    @media (max-width: 980px){ .stickyBar{display:block} body{padding-bottom:80px} }
  
    .modalBody .actions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 560px){ .modalBody .actions{ grid-template-columns:1fr; } }

    .copyRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top:10px;
    }
    .miniBtn{
      border:1px solid rgba(18,18,18,.16);
      background:#fff;
      color:#111;
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
    }
    .statusOk{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(245,196,0,.18);
      border:1px solid rgba(245,196,0,.45);
      font-size:12px;
      color: rgba(18,18,18,.78);
      font-weight:800;
    }
    .statusBad{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius: 999px;
      background: rgba(26,26,26,.06);
      border:1px solid rgba(18,18,18,.18);
      font-size:12px;
      color: rgba(18,18,18,.78);
      font-weight:800;
    }
    .msgBox{
      width:100%;
      margin-top:12px;
      padding:12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(18,18,18,.16);
      background: #fff;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12.5px;
      line-height: 1.35;
      max-height: 42vh;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      white-space: pre-wrap;
    }

  
    #bookingModal .modalBody{
      max-height: 70vh;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
    }

  </style>
</head>

<body>
  <div class="wrap">
    <section class="hero">
      <div class="badge">Toronto & GTA • Deep Cleaning • +30 min FREE</div>
      <h1>Deep Cleaning Price Calculator</h1>
      <p class="sub">Time-based estimate with a clear minimum. Minimum order is <b>$195</b> for <b>5 hours</b>, plus <b>30 minutes FREE</b> on top.</p>
      <div class="heroRow">
        <div class="heroPill">Minimum: <b>$195 / 5 hours</b></div>
        <div class="heroPill">Bonus: <b>+30 minutes FREE</b></div>
        <div class="heroPill">Area unit: <b>sq ft</b> (default)</div>
      </div>
    </section>

    <div class="grid">
      <section class="card" id="calculator">
        <h2>Estimate</h2>
        <div class="muted">Enter details and tap “Calculate”.</div>

        <div class="row">
          <div>
            <label>Bedrooms</label>
            <input id="bedrooms" type="number" min="0" value="1" />
          </div>
          <div>
            <label>Bathrooms</label>
            <input id="bathrooms" type="number" min="0" value="1" />
          </div>
        </div>

        <label>Kitchens</label>
        <input id="kitchens" type="number" min="0" value="1" />

        
<div class="row">
  <div>
    <label>Floors</label>
    <input id="floors" type="number" min="1" value="1" />
  </div>
  <div>
    <label>Dining rooms</label>
    <input id="diningRooms" type="number" min="0" value="1" />
  </div>
</div>

<label>Basement</label>
<input id="basements" type="number" min="0" value="0" />
<div class="unitbar">
          <div>
            <div style="font-weight:950">Area unit</div>
            <div class="muted" id="unitHint">Default: sq ft</div>
          </div>
          <div class="seg" role="tablist" aria-label="Area unit">
            <button id="unitSqft" class="active" type="button" aria-selected="true">sq ft</button>
            <button id="unitM2" type="button" aria-selected="false">m²</button>
          </div>
        </div>

        <label id="areaLabel">Total area (sq ft)</label>
        <input id="area" type="number" min="0" value="800" placeholder="e.g., 800" />

        <button class="btn" id="calcBtn" type="button">Calculate</button>
        <button class="btn secondary" id="includedBtn" type="button">What’s included in deep cleaning?</button>

        <div class="result" aria-live="polite">
          <div class="priceTop">
            <div class="priceLabel">Estimated price</div>
            <div class="priceValue" id="priceText">$—</div>
          </div>
          <div class="note" id="priceNote">Time-based estimate. Final price depends on condition and level of soiling.</div>

          <div class="timebox">
            <div class="pill" id="billableTime">Billable time: <b>—</b></div>
            <div class="pill" id="onsiteTime">On-site time: <b>—</b></div>
          </div>

          <div class="ctaRow">
            <a class="contactBtn dark" href="#booking">Get an exact quote</a>
            <a class="contactBtn" href="#pricing">How pricing works</a>
          </div>
        </div>

        <div class="small" style="margin-top:10px">
          * This is an estimate based on size and layout. Deep cleaning complexity can change the final time and price.
        </div>
      </section>

      <aside class="card" id="pricing">
        <h2>How pricing works</h2>
        <p class="muted" style="margin:0 0 10px">
          We estimate <b>billable time</b> from bedrooms, bathrooms, kitchens, floors, dining rooms, basement, and area. There is a <b>5-hour minimum</b>.
          On-site time always includes <b>+30 minutes FREE</b>. Minimum order price is <b>$195</b>.<br><span class="muted" style="font-size:12px">Maximum billable time is <b>10 hours</b> (+30 min FREE on-site).</span>
        </p>

        <div class="hr"></div>

        <h2 style="margin-top:0">Quick contact</h2>
        <div class="muted">Ask a question, clarify details, or book directly:</div>
        <div class="contactGrid">
          <a class="contactBtn yellow" href="https://ig.me/m/northstarclean17" target="_blank" rel="noopener">Write on Instagram</a>
          <a class="contactBtn dark" href="https://m.me/Northstarclean17" target="_blank" rel="noopener">Write on Facebook</a>
        </div>

        <div class="hr"></div>

        <div class="muted" style="margin-bottom:8px"><b>Minimum order</b></div>
        <div class="heroPill" style="display:inline-block;margin-bottom:8px">Starting at <b>$195 for 5 hours + 30 min. FREE</b></div>
        <div class="muted">To confirm your booking and choose the most convenient dates, we will give you a quick call. <b>No prepayment required.</b></div>
      </aside>
    </div>

    <section class="card" id="booking" style="margin-top:16px">
      <h2>Booking details</h2>
      <div class="muted">Fill in your details, tap “Book now”, then send the copied message to us on Instagram or Facebook. We’ll call you to confirm the booking and choose the most convenient date/time. No prepayment required.</div>

      <div class="row" style="margin-top:6px">
        <div>
          <label>Name</label>
          <input id="bName" placeholder="Name" />
        </div>
        <div>
          <label>Email</label>
          <input id="bEmail" type="email" placeholder="Email" />
        </div>
      </div>

      <label>Address</label>
      <input id="bAddress" placeholder="Address" />

      <div class="row">
        <div>
          <label>Phone</label>
          <input id="bPhone" type="tel" placeholder="Phone number" />
        </div>
        <div>
          <label>Preferred dates/times</label>
          <input id="bPreferred" placeholder="e.g., Sat 10–12 or Mon evening" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Pay Cash (Yes/No)</label>
          <select id="bCash">
            <option value="">Select</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
        <div>
          <label>Pets</label>
          <select id="bPets">
            <option value="">Select</option>
            <option>No</option>
            <option>Yes</option>
          </select>
        </div>
      </div>

<label>Wishes &amp; additional notes</label>
      <textarea id="bNotes" placeholder="Any wishes, extra details, access instructions, parking, etc."></textarea>

      <div class="row">
        <button class="btn" id="bookBtn" type="button">Book now</button>
        <div class="small" style="display:flex;align-items:center;padding:10px 4px;color:rgba(18,18,18,.70)">
          After you send the message: we’ll call you to confirm the booking and choose the most convenient date/time. No prepayment required.
        </div>
      </div>

      <div class="contactGrid">
        <a class="contactBtn yellow" href="https://ig.me/m/northstarclean17" target="_blank" rel="noopener">Write on Instagram</a>
        <a class="contactBtn dark" href="https://m.me/Northstarclean17" target="_blank" rel="noopener">Write on Facebook</a>
      </div>

      <div class="small" id="copyStatus" style="margin-top:10px"></div>

      <div class="hr"></div>
      <div class="muted"><b>After you send the message:</b> we’ll call you to confirm the booking and choose the most convenient date/time. <b>No prepayment required.</b></div>
    </section>
  </div>

  <div class="modal" id="includedModal" role="dialog" aria-modal="true" aria-labelledby="includedTitle">
    <div class="modalCard">
      <div class="modalHeader">
        <h3 id="includedTitle">What’s included in deep cleaning</h3>
        <button class="closeBtn" id="closeModal" type="button">Close</button>
      </div>
      <div class="modalBody">
        <div class="muted" style="margin-bottom:12px">Scroll to view the full checklist images.</div>
        <div class="gallery">
          <div class="gItem">
            <div class="cap"><span class="gTitle">Bedrooms</span> deep cleaning tasks</div>
            <img src="assets/deep-cleaning-bedrooms.jpg" alt="Deep cleaning bedrooms tasks" loading="lazy" />
          </div>
          <div class="gItem">
            <div class="cap"><span class="gTitle">Kitchen</span> deep cleaning tasks</div>
            <img src="assets/deep-cleaning-kitchen.jpg" alt="Deep cleaning kitchen tasks" loading="lazy" />
          </div>
          <div class="gItem">
            <div class="cap"><span class="gTitle">Bathroom</span> deep cleaning tasks</div>
            <img src="assets/deep-cleaning-bathroom.jpg" alt="Deep cleaning bathroom tasks" loading="lazy" />
          </div>
          <div class="gItem">
            <div class="cap"><span class="gTitle">General spaces</span> deep cleaning tasks</div>
            <img src="assets/deep-cleaning-general-spaces.jpg" alt="Deep cleaning general spaces tasks" loading="lazy" />
          </div>
        </div>
        </div>
    </div>
  </div>

  <div class="stickyBar" aria-hidden="true">
    <div class="inner">
      <a class="contactBtn yellow" href="https://ig.me/m/northstarclean17" target="_blank" rel="noopener">Write on Instagram</a>
      <a class="contactBtn dark" href="https://m.me/Northstarclean17" target="_blank" rel="noopener">Write on Facebook</a>
    </div>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  // ========= CONFIG =========
  const PRICING = {
    hourlyRate: 39,          // $/hour
    maxMultiplier: 1.15,     // show a range (up to +15%)
    freeHours: 0.5,          // +30 min FREE on-site
    minBillableHours: 5.0,   // minimum order = 5 hours
    maxBillableHours: 10.0,  // cap: cannot book more than 10h (+30 min FREE)
  };

  const SQFT_PER_M2 = 10.7639;

  // ========= DOM =========
  const els = {
    unitSqft: document.getElementById("unitSqft"),
    unitM2: document.getElementById("unitM2"),
    unitHint: document.getElementById("unitHint"),
    areaLabel: document.getElementById("areaLabel"),

    bedrooms: document.getElementById("bedrooms"),
    bathrooms: document.getElementById("bathrooms"),
    kitchens: document.getElementById("kitchens"),
    floors: document.getElementById("floors"),
    diningRooms: document.getElementById("diningRooms"),
    basements: document.getElementById("basements"),
    area: document.getElementById("area"),

    calcBtn: document.getElementById("calcBtn"),

    priceRangeText: document.getElementById("priceRangeText"),
    billableHoursText: document.getElementById("billableHoursText"),
    onSiteHoursText: document.getElementById("onSiteHoursText"),

    // Booking fields
    bName: document.getElementById("bName"),
    bPhone: document.getElementById("bPhone"),
    bAddress: document.getElementById("bAddress"),
    bEmail: document.getElementById("bEmail"),
    bPreferred: document.getElementById("bPreferred"),
    bCash: document.getElementById("bCash"),
    bPets: document.getElementById("bPets"),
    bNotes: document.getElementById("bNotes"),

    bookBtn: document.getElementById("bookBtn"),

    // Included modal
    includedBtn: document.getElementById("includedBtn"),
    includedModal: document.getElementById("includedModal"),
    closeModal: document.getElementById("closeModal"),

    // Booking modal (post-copy popup)
    bookingModal: document.getElementById("bookingModal"),
    closeBookingModal: document.getElementById("closeBookingModal"),
    bookingCopyStatus: document.getElementById("bookingCopyStatus"),
    copyAgainBtn: document.getElementById("copyAgainBtn"),
    bookingMsgBox: document.getElementById("bookingMsgBox"),
  };

  // ========= STATE =========
  let currentUnit = "sqft"; // default
  let lastEstimate = null;  // cache latest estimate

  // ========= HELPERS =========
  const clamp = (n, min, max) => Math.min(max, Math.max(min, n));

  function safeNumber(val) {
    if (val == null) return 0;
    const s = String(val).trim().replace(",", ".");
    const n = parseFloat(s);
    return Number.isFinite(n) ? n : 0;
  }

  function safeInt(val) {
    const n = Math.round(safeNumber(val));
    return Number.isFinite(n) ? n : 0;
  }

  function fmtHours(h) {
    const x = Math.round(h * 100) / 100;
    if (Number.isInteger(x)) return x.toFixed(1); // 5.0
    let s = x.toFixed(2);
    s = s.replace(/0$/, "");
    return s;
  }

  function fmtMoney(n) {
    return Math.round(n);
  }

  function roundToQuarter(hours) {
    return Math.round(hours * 4) / 4;
  }

  // ========= UNIT HANDLING =========
  function setUnit(unit, convertValue = true) {
    if (unit !== "sqft" && unit !== "m2") return;
    if (unit === currentUnit) return;

    if (convertValue) {
      const v = safeNumber(els.area.value);
      if (v > 0) {
        const converted = unit === "m2"
          ? (v / SQFT_PER_M2)
          : (v * SQFT_PER_M2);
        // Keep it clean: area doesn't need many decimals.
        els.area.value = Math.round(converted);
      }
    }

    currentUnit = unit;

    els.unitSqft.setAttribute("aria-selected", unit === "sqft" ? "true" : "false");
    els.unitM2.setAttribute("aria-selected", unit === "m2" ? "true" : "false");

    els.areaLabel.textContent = unit === "sqft" ? "Total area (sq ft)" : "Total area (m²)";
    els.unitHint.textContent = unit === "sqft"
      ? "Tip: most people in Canada use sq ft."
      : "Tip: switch to sq ft if you know it.";

    // If user already has an estimate on screen, refresh it.
    if (lastEstimate) renderEstimate();
  }

  // ========= INPUTS =========
  function getInputs() {
    const bedrooms = safeNumber(els.bedrooms.value);
    const bathrooms = safeNumber(els.bathrooms.value);
    const kitchens = safeInt(els.kitchens.value);
    const floors = safeInt(els.floors.value);
    const diningRooms = safeInt(els.diningRooms.value);

    // Basement is treated as 0/1 in pricing (anything >0 counts as 1)
    const basementRaw = safeInt(els.basements.value);
    const basements = basementRaw > 0 ? 1 : 0;

    const areaRaw = safeNumber(els.area.value);
    const areaSqft = currentUnit === "m2" ? (areaRaw * SQFT_PER_M2) : areaRaw;

    return {
      bedrooms,
      bathrooms,
      kitchens,
      floors,
      diningRooms,
      basements,
      areaRaw,
      areaSqft,
      unit: currentUnit,
    };
  }

  // ========= PRICING ALGORITHM =========
  function baseHoursByArea(areaSqft) {
    const a = Math.max(1, areaSqft);

    if (a <= 999) return 4.75;
    if (a <= 1499) return 5.00;
    if (a <= 1999) return 5.00; // your benchmark
    if (a <= 2499) return 6.00;
    if (a <= 2999) return 6.25;
    if (a <= 3499) return 8.25;

    // 3500+ -> 8.25 + 0.75h per +500 sqft (linear)
    return 8.25 + 0.75 * ((a - 3500) / 500);
  }

  function normsByArea(areaSqft) {
    const a = Math.max(1, areaSqft);

    if (a <= 999) return { bed: 2, bath: 1 };
    if (a <= 1499) return { bed: 2, bath: 2 };
    if (a <= 1999) return { bed: 3, bath: 2 }; // benchmark
    if (a <= 2499) return { bed: 3, bath: 2 };
    if (a <= 2999) return { bed: 4, bath: 3 };
    return { bed: 4, bath: 3 }; // 3000+
  }

  function computeBillableHoursDeep(inputs) {
    let hours = baseHoursByArea(inputs.areaSqft);

    // Extras above "standard" that is already included in the area base:
    // Kitchen included 1, Dining included 1, Floors included 1, Basement included 0
    const extraKitchens = Math.max(0, inputs.kitchens - 1);
    const extraDining = Math.max(0, inputs.diningRooms - 1);
    const extraFloors = Math.max(0, inputs.floors - 1);
    const extraBasement = inputs.basements > 0 ? 1 : 0;

    hours += extraKitchens * 0.75;
    hours += extraDining * 0.25;
    hours += extraFloors * 0.35;
    hours += extraBasement * 0.90;

    // Bedrooms / bathrooms: only above norm for area (soft correction)
    const norms = normsByArea(inputs.areaSqft);
    const extraBed = Math.max(0, inputs.bedrooms - norms.bed);
    const extraBath = Math.max(0, inputs.bathrooms - norms.bath);

    hours += extraBed * 0.25;
    hours += extraBath * 0.60; // 0.5 bath => 0.30h, 1 bath => 0.60h

    // Round to nearest 0.25 hours
    let billable = roundToQuarter(hours);

    // Minimum order + cap
    billable = clamp(billable, PRICING.minBillableHours, PRICING.maxBillableHours);

    return billable;
  }

  function computePriceRange(billableHours) {
    const base = billableHours * PRICING.hourlyRate;
    const minPrice = fmtMoney(base);
    const maxPrice = fmtMoney(base * PRICING.maxMultiplier);
    return { minPrice, maxPrice };
  }

  function renderEstimate() {
    const inputs = getInputs();
    const billable = computeBillableHoursDeep(inputs);
    const onSite = billable + PRICING.freeHours;
    const { minPrice, maxPrice } = computePriceRange(billable);

    lastEstimate = {
      ...inputs,
      billable,
      onSite,
      minPrice,
      maxPrice,
    };

    if (els.priceRangeText) els.priceRangeText.textContent = `$${minPrice}–$${maxPrice}`;
    if (els.billableHoursText) els.billableHoursText.textContent = `${fmtHours(billable)} hrs`;
    if (els.onSiteHoursText) els.onSiteHoursText.textContent = `${fmtHours(onSite)} hrs (+30 min FREE)`;
  }

  // ========= BOOKING MESSAGE =========
  function buildBookingMessage() {
    // Ensure we have a fresh estimate
    renderEstimate();
    const e = lastEstimate;

    const areaLine = e.unit === "m2"
      ? `Area: ${Math.round(e.areaRaw)} m²`
      : `Area: ${Math.round(e.areaRaw)} sq ft`;

    // IMPORTANT: no "(minimum $195)" here. Only show the range.
    const msg =
`Hi! I'd like to book a Deep Cleaning.

--- Estimate from calculator ---
Bedrooms: ${e.bedrooms}
Bathrooms: ${e.bathrooms}
Kitchens: ${e.kitchens}
Floors: ${e.floors}
Dining rooms: ${e.diningRooms}
Basement: ${e.basements}
${areaLine}
Estimated price: $${e.minPrice}–$${e.maxPrice}
Billable time: ${fmtHours(e.billable)} hrs
On-site time: ${fmtHours(e.onSite)} hrs (+30 min FREE)

Name: ${els.bName?.value || ""}
Phone: ${els.bPhone?.value || ""}
Address: ${els.bAddress?.value || ""}
Email: ${els.bEmail?.value || ""}
Preferred dates/times: ${els.bPreferred?.value || ""}
Pay Cash (Yes/No): ${els.bCash?.value || ""}
Pets: ${els.bPets?.value || ""}
Wishes & additional notes: ${els.bNotes?.value || ""}

Thank you!`;

    return msg;
  }

  async function copyToClipboard(text) {
    try {
      await navigator.clipboard.writeText(text);
      return true;
    } catch (err) {
      // Fallback (older browsers / permissions)
      try {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.style.top = "-9999px";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(ta);
        return !!ok;
      } catch (e) {
        return false;
      }
    }
  }

  function openBookingModal(message, copied) {
    if (!els.bookingModal) return;

    els.bookingMsgBox.value = message;
    els.bookingCopyStatus.textContent = copied
      ? "Copied to clipboard. Now tap Instagram or Facebook and paste the message."
      : "Couldn’t auto-copy on this device. Please copy the message from the box below, then tap Instagram or Facebook.";

    els.bookingModal.setAttribute("aria-hidden", "false");
    els.bookingModal.classList.add("open");
  }

  function closeBookingModal() {
    if (!els.bookingModal) return;
    els.bookingModal.setAttribute("aria-hidden", "true");
    els.bookingModal.classList.remove("open");
  }

  async function openBookingFlow() {
    const message = buildBookingMessage();
    const copied = await copyToClipboard(message);
    openBookingModal(message, copied);
  }

  // ========= INCLUDED MODAL =========
  function openIncludedModal() {
    if (!els.includedModal) return;
    els.includedModal.setAttribute("aria-hidden", "false");
    els.includedModal.classList.add("open");
  }

  function closeIncludedModal() {
    if (!els.includedModal) return;
    els.includedModal.setAttribute("aria-hidden", "true");
    els.includedModal.classList.remove("open");
  }

  // ========= EVENTS =========
  if (els.unitSqft) els.unitSqft.addEventListener("click", () => setUnit("sqft"));
  if (els.unitM2) els.unitM2.addEventListener("click", () => setUnit("m2"));

  if (els.calcBtn) els.calcBtn.addEventListener("click", () => renderEstimate());

  // Book button: copy + open popup (best for conversion)
  if (els.bookBtn) els.bookBtn.addEventListener("click", (e) => {
    e.preventDefault();
    openBookingFlow();
  });

  // Booking modal controls
  if (els.closeBookingModal) els.closeBookingModal.addEventListener("click", closeBookingModal);
  if (els.copyAgainBtn) els.copyAgainBtn.addEventListener("click", async () => {
    const msg = buildBookingMessage();
    const copied = await copyToClipboard(msg);
    els.bookingCopyStatus.textContent = copied
      ? "Copied again. Now paste it in the chat."
      : "Still can’t auto-copy here. Please copy the text manually from the box.";
  });

  // Close booking modal on backdrop click
  if (els.bookingModal) {
    els.bookingModal.addEventListener("click", (e) => {
      if (e.target === els.bookingModal) closeBookingModal();
    });
  }

  // Included modal controls
  if (els.includedBtn) els.includedBtn.addEventListener("click", openIncludedModal);
  if (els.closeModal) els.closeModal.addEventListener("click", closeIncludedModal);
  if (els.includedModal) {
    els.includedModal.addEventListener("click", (e) => {
      if (e.target === els.includedModal) closeIncludedModal();
    });
  }

  // ESC closes any open modal
  document.addEventListener("keydown", (e) => {
    if (e.key !== "Escape") return;
    closeIncludedModal();
    closeBookingModal();
  });

  // ========= INIT =========
  // Default unit is sq ft (better for Canada)
  currentUnit = "sqft";
  if (els.unitSqft) els.unitSqft.setAttribute("aria-selected", "true");
  if (els.unitM2) els.unitM2.setAttribute("aria-selected", "false");
  if (els.areaLabel) els.areaLabel.textContent = "Total area (sq ft)";
  if (els.unitHint) els.unitHint.textContent = "Tip: most people in Canada use sq ft.";

  renderEstimate();
});
</script>

  <div class="modal" id="bookingModal" role="dialog" aria-modal="true" aria-labelledby="bookingTitle">
    <div class="modalCard">
      <div class="modalHeader">
        <h3 id="bookingTitle">Final step: send your booking message</h3>
        <button class="closeBtn" id="closeBookingModal" type="button">Close</button>
      </div>
      <div class="modalBody">
        <div class="muted" style="margin-bottom:10px">
          To finalize the booking, please send the copied message to us on Instagram or Facebook.
        </div>

        <div class="copyRow">
          <div id="bookingCopyStatus" class="statusOk">✅ Message copied to clipboard</div>
          <button class="miniBtn" id="copyAgainBtn" type="button">Copy again</button>
        </div>

        <div class="actions">
          <a class="contactBtn yellow" href="https://ig.me/m/northstarclean17" target="_blank" rel="noopener">Write on Instagram</a>
          <a class="contactBtn dark" href="https://m.me/Northstarclean17" target="_blank" rel="noopener">Write on Facebook</a>
        </div>

        <div class="small" style="margin-top:10px">
          Tip: After opening the chat, tap and hold the message box, then choose <b>Paste</b>.
        </div>

        <textarea class="msgBox" id="bookingMsgBox" readonly></textarea>
      </div>
    </div>
  </div>

</body>
</html>
